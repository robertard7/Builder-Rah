name: openapi-validate

on:
  workflow_dispatch:   # MANUAL ONLY â€” no runner starvation

jobs:
  validate:
    runs-on: [self-hosted, Windows, X64, Builder-Rah]

    defaults:
      run:
        shell: pwsh

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'

      - name: Verify environment
        run: |
          node --version
          npm --version
          dotnet --version
          Write-Host "PWD=$PWD"

      - name: Validate OpenAPI spec
        run: |
          if (-not (Test-Path "./scripts/validate-openapi.ps1")) {
            throw "Missing script: scripts/validate-openapi.ps1"
          }
          ./scripts/validate-openapi.ps1

      - name: Validate OpenAPI client contract
        run: |
          if (-not (Test-Path "./scripts/validate-openapi-client.ps1")) {
            throw "Missing script: scripts/validate-openapi-client.ps1"
          }
          ./scripts/validate-openapi-client.ps1
